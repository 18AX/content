id: QRadar Advanced Searching
version: -1
name: QRadar Advanced Searching
description: |-
  The Playbook queries QRadar SIEM using complex queries in case the provided search values require several conditions. Complex queries take into consideration several inputs and allow to include or exclude each of the values as well as perform a full or partial search. Each of the values can be searched across several fields.
  The playbook supports 3 full separate conditions to be evaluated

  For example in the first inputs will evaluate several user names that may or may not exist in several fields. The second input can for example evaluate for IP addresses in several fields that may or may not exist in several fields and a third value can search for an event id that may or may not exist in several fields. The results of all of the inputs will create an AQL query that covers all of the inputs combining all of the different conditions.

  Each of the inputs is validated so in case the inputs are not set correctly the user can review and run again.
  Also notice that populated inputs will be combined, meaning by populating the first and second values the resulting AQL query will be a combination of all of them and not 3 separate searches. In addition to that make sure to populate the inputs in order both according to the indexed fields in QRadar (indexed fields should be provided before non indexed ones) and don't leave a blanc input, meaning if you have 1 inputs make sure its in the first input and if you have two inputs they need to be in the first and second input and not skip to the third.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 58539ed8-2f4e-43cf-8465-d670bea68a9d
    type: start
    task:
      id: 58539ed8-2f4e-43cf-8465-d670bea68a9d
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "55"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 600,
          "y": -2260
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: 96914dd7-fda8-4963-8ce0-eabe6c1587b9
    type: title
    task:
      id: 96914dd7-fda8-4963-8ce0-eabe6c1587b9
      version: -1
      name: First Input Search
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "231"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1070,
          "y": -1950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: c14b9cb1-23b3-423c-89ee-1e45a57b20f0
    type: condition
    task:
      id: c14b9cb1-23b3-423c-89ee-1e45a57b20f0
      version: -1
      name: Were the first inputs provided properly?
      description: Is there an IP on which to search?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "232"
      "yes":
      - "50"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.FirstFieldValue
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              simple: inputs.FirstFieldState
            iscontext: true
          right:
            value:
              simple: include
        - operator: isEqualString
          left:
            value:
              simple: inputs.FirstFieldState
            iscontext: true
          right:
            value:
              simple: exclude
      - - operator: isEqualString
          left:
            value:
              simple: inputs.FirstFieldMatch
            iscontext: true
          right:
            value:
              simple: exact
        - operator: isEqualString
          left:
            value:
              simple: inputs.FirstFieldMatch
            iscontext: true
          right:
            value:
              simple: partial
    view: |-
      {
        "position": {
          "x": 1320,
          "y": -1520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "50":
    id: "50"
    taskid: d2048001-4792-4616-8aff-2d32d8b8182b
    type: condition
    task:
      id: d2048001-4792-4616-8aff-2d32d8b8182b
      version: -1
      name: Are there fields for the first input?
      description: Is there a custom IP field?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "59"
      "yes":
      - "58"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: inputs.FirstFieldName
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1320,
          "y": -1120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "55":
    id: "55"
    taskid: b02b0018-bcb7-4a8d-85e6-ab71472ab750
    type: condition
    task:
      id: b02b0018-bcb7-4a8d-85e6-ab71472ab750
      version: -1
      name: Is Qradar enabled?
      description: Is Qradar enabled?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "164"
      "yes":
      - "5"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: inList
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: QRadar,QRadar_v2,QRadar v3
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
    view: |-
      {
        "position": {
          "x": 600,
          "y": -2130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "58":
    id: "58"
    taskid: 581100f1-c920-4646-8cb3-7ce525c52f54
    type: title
    task:
      id: 581100f1-c920-4646-8cb3-7ce525c52f54
      version: -1
      name: QRadar query with custom fields
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "169"
      - "236"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1680,
          "y": -940
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "59":
    id: "59"
    taskid: 5fe3a742-3b2a-4d5e-8350-bd553be239de
    type: title
    task:
      id: 5fe3a742-3b2a-4d5e-8350-bd553be239de
      version: -1
      name: QRadar query without custom fields
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "178"
      - "177"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1020,
          "y": -940
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "120":
    id: "120"
    taskid: 3c44cee4-6746-4a2a-8e8d-a9075b3b4364
    type: title
    task:
      id: 3c44cee4-6746-4a2a-8e8d-a9075b3b4364
      version: -1
      name: Sort internal and external IP addresses
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "124"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 630,
          "y": 6200
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "123":
    id: "123"
    taskid: 8ccce2b7-1b19-4bd2-8444-96ae87a034ed
    type: regular
    task:
      id: 8ccce2b7-1b19-4bd2-8444-96ae87a034ed
      version: -1
      name: Set detected IP addresses as external
      description: Checks if the specified value exists in context. If the value exists,
        it will be set in context, otherwise no value will be set it context.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "165"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: QRadar.DetectedExternalIPs
      value:
        complex:
          root: IP
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: IP.InRange
                iscontext: true
              right:
                value:
                  simple: "no"
          accessor: Address
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 730,
          "y": 6880
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "124":
    id: "124"
    taskid: 2c9fb8ea-e8f2-4f0d-8ebc-3d644e52e60b
    type: condition
    task:
      id: 2c9fb8ea-e8f2-4f0d-8ebc-3d644e52e60b
      version: -1
      name: Are there detected IP addresses?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "165"
      "yes":
      - "142"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: QRadar.DetectedIPs
            iscontext: true
    view: |-
      {
        "position": {
          "x": 630,
          "y": 6330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "142":
    id: "142"
    taskid: dfd3df8d-3970-4527-8baf-017cb5600cff
    type: regular
    task:
      id: dfd3df8d-3970-4527-8baf-017cb5600cff
      version: -1
      name: Determine whether the IP address is internal or external
      description: Returns yes if the IP is in one of the ranges provided, returns
        no otherwise.
      scriptName: IsIPInRanges
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "143"
    scriptarguments:
      ip:
        simple: ${QRadar.DetectedIPs}
      ipRanges:
        simple: ${inputs.InternalRange}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 730,
          "y": 6550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "143":
    id: "143"
    taskid: c5ad840d-fc96-4282-8dfd-67eb7ffb3da9
    type: regular
    task:
      id: c5ad840d-fc96-4282-8dfd-67eb7ffb3da9
      version: -1
      name: Set detected IP addresses as internal
      description: Checks if the specified value exists in context. If the value exists,
        it will be set in context, otherwise no value will be set it context.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "123"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: QRadar.DetectedInternalIPs
      value:
        complex:
          root: IP
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: IP.InRange
                iscontext: true
              right:
                value:
                  simple: "yes"
          accessor: Address
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 730,
          "y": 6710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "160":
    id: "160"
    taskid: 5676b03a-78bb-4b88-86f3-8b6277c4fdcb
    type: regular
    task:
      id: 5676b03a-78bb-4b88-86f3-8b6277c4fdcb
      version: -1
      name: Set detected source and destination IP addresses
      description: Sets a value into the context with the given context key
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "161"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: QRadar.DetectedIPs
      value:
        complex:
          root: ${
          accessor: =[]}
          transformers:
          - operator: GetValuesOfMultipleFields
            args:
              key:
                value:
                  simple: QRadar.Search.Result.events
                iscontext: true
              list:
                value:
                  simple: inputs.InvestigationIPFields
                iscontext: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 630,
          "y": 5380
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "161":
    id: "161"
    taskid: e7ce21c3-cfcd-4468-8a2a-ffff8a33897e
    type: regular
    task:
      id: e7ce21c3-cfcd-4468-8a2a-ffff8a33897e
      version: -1
      name: Set detected usernames
      description: Sets a value into the context with the given context key
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "162"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: QRadar.DetectedUsers
      value:
        complex:
          root: ${
          accessor: =[]}
          transformers:
          - operator: GetValuesOfMultipleFields
            args:
              key:
                value:
                  simple: QRadar.Search.Result.events
                iscontext: true
              list:
                value:
                  simple: inputs.InvestigationUserFields
                iscontext: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 630,
          "y": 5550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "162":
    id: "162"
    taskid: 106608e6-f93a-4f1e-82d8-1f819b72f425
    type: regular
    task:
      id: 106608e6-f93a-4f1e-82d8-1f819b72f425
      version: -1
      name: Get hostnames from assets
      description: List all assets found in the model
      script: '|||qradar-get-assets'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "163"
    scriptarguments:
      filter:
        complex:
          root: ${QRadar
          accessor: DetectedIPs}
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: interfaces contains ip_addresses contains value= "
              suffix:
                value:
                  simple: '"'
          - operator: join
            args:
              separator:
                value:
                  simple: ' OR '
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 630,
          "y": 5750
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "163":
    id: "163"
    taskid: 8c80a293-ce03-4618-841d-a8f43bf9171c
    type: regular
    task:
      id: 8c80a293-ce03-4618-841d-a8f43bf9171c
      version: -1
      name: Set detected hostnames from assets
      description: Sets a value into the context with the given context key
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "120"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: QRadar.DetectedInternalHosts
      value:
        complex:
          root: ${QRadar
          accessor: Asset.Name.Value}
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 630,
          "y": 5960
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "164":
    id: "164"
    taskid: 627999b4-7df9-4fd8-8fc2-617115e5a147
    type: condition
    task:
      id: 627999b4-7df9-4fd8-8fc2-617115e5a147
      version: -1
      name: Have results been detected?
      description: Is domain or url detected by QRadar?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "165"
      "yes":
      - "166"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: QRadar.Search.Result
            iscontext: true
    view: |-
      {
        "position": {
          "x": 540,
          "y": 4980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "165":
    id: "165"
    taskid: 17fad474-433c-4bc6-86bd-acb3a0613907
    type: title
    task:
      id: 17fad474-433c-4bc6-86bd-acb3a0613907
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 400,
          "y": 7060
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "166":
    id: "166"
    taskid: efd45309-ef61-4839-882d-d0e0156a977d
    type: title
    task:
      id: efd45309-ef61-4839-882d-d0e0156a977d
      version: -1
      name: Set detecetd Values
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "160"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 630,
          "y": 5250
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "167":
    id: "167"
    taskid: d9353993-37ac-4632-8595-5ae4b3a826ea
    type: playbook
    task:
      id: d9353993-37ac-4632-8595-5ae4b3a826ea
      version: -1
      name: QRadarFullSearch
      description: This playbook runs a QRadar query and return its results to the
        context.
      playbookName: QRadarFullSearch
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "164"
    scriptarguments:
      interval:
        simple: "1"
      query_expression:
        complex:
          root: ${FirstInputQuery}
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: ' from events where '
              suffix: {}
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ' '
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: inputs.TimeFrame
                iscontext: true
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.InvestigationUserFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ','
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.InvestigationIPFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ','
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.AdditionalSelectFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ','
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'DATEFORMAT(devicetime,''dd-MM-yyyy hh:mm''),LOGSOURCENAME(logsourceid),CATEGORYNAME(category),QIDNAME(qid) '
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'select '
              suffix:
                iscontext: true
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ',,'
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ' '
              toReplace:
                value:
                  simple: '  '
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ' ,'
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ', '
      timeout:
        simple: "600"
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 1670,
          "y": 585
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "168":
    id: "168"
    taskid: 2752b10a-e0e6-492b-8d7c-00edee60fcd2
    type: regular
    task:
      id: 2752b10a-e0e6-492b-8d7c-00edee60fcd2
      version: -1
      name: Set state
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "176"
    scriptarguments:
      key:
        simple: State1
      value:
        simple: ' '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1670,
          "y": -615
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "169":
    id: "169"
    taskid: 31318080-bdfe-43f2-8ccc-ede62f1e1021
    type: regular
    task:
      id: 31318080-bdfe-43f2-8ccc-ede62f1e1021
      version: -1
      name: Set match
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "176"
    scriptarguments:
      key:
        simple: Match1
      value:
        complex:
          root: inputs.FirstFieldMatch
          transformers:
          - operator: If-Then-Else
            args:
              condition: {}
              else:
                value:
                  simple: ' ILIKE '
              equals:
                value:
                  simple: exact
              lhs: {}
              options: {}
              rhs: {}
              then:
                value:
                  simple: '= '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2820,
          "y": -795
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "170":
    id: "170"
    taskid: f0c86abb-b44b-4b4d-81a3-3f142b929126
    type: regular
    task:
      id: f0c86abb-b44b-4b4d-81a3-3f142b929126
      version: -1
      name: Set values
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "174"
    scriptarguments:
      key:
        simple: FirstInputQuery
      value:
        complex:
          root: inputs.FirstFieldName
          transformers:
          - operator: ProductJoin
            args:
              join:
                value:
                  simple: ${FirstStateMatch}
                iscontext: true
              list2:
                value:
                  simple: ${FirstValues}
                iscontext: true
          - operator: concat
            args:
              prefix:
                value:
                  simple: ' '
              suffix: {}
          - operator: join
            args:
              separator:
                value:
                  simple: ','
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ' OR '
              toReplace:
                value:
                  simple: ','
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1670,
          "y": 80
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "171":
    id: "171"
    taskid: acdb42cc-97a0-45e7-8d73-63be0072b454
    type: condition
    task:
      id: acdb42cc-97a0-45e7-8d73-63be0072b454
      version: -1
      name: First match exact or partial?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      exact:
      - "172"
      partial:
      - "173"
    separatecontext: false
    conditions:
    - label: exact
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.FirstFieldMatch
            iscontext: true
          right:
            value:
              simple: exact
    - label: partial
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.FirstFieldMatch
            iscontext: true
          right:
            value:
              simple: partial
    view: |-
      {
        "position": {
          "x": 1670,
          "y": -265
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "172":
    id: "172"
    taskid: 8fc5dce1-8859-4d49-8cb5-236249c53d4a
    type: regular
    task:
      id: 8fc5dce1-8859-4d49-8cb5-236249c53d4a
      version: -1
      name: Set exact values
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "170"
    scriptarguments:
      key:
        simple: FirstValues
      value:
        complex:
          root: inputs.FirstFieldValue
          transformers:
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
          - operator: concat
            args:
              prefix:
                value:
                  simple: ''''
              suffix:
                value:
                  simple: ''''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1470,
          "y": -95
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "173":
    id: "173"
    taskid: 396699c2-b56f-4eef-871f-a339ee5178c8
    type: regular
    task:
      id: 396699c2-b56f-4eef-871f-a339ee5178c8
      version: -1
      name: Set partial values
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "170"
    scriptarguments:
      key:
        simple: FirstValues
      value:
        complex:
          root: inputs.FirstFieldValue
          transformers:
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
          - operator: concat
            args:
              prefix:
                value:
                  simple: '''%'
              suffix:
                value:
                  simple: '%'''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1880,
          "y": -95
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "174":
    id: "174"
    taskid: 31edc6ca-cf7b-47ab-8565-e038128d1348
    type: condition
    task:
      id: 31edc6ca-cf7b-47ab-8565-e038128d1348
      version: -1
      name: Are there second input values?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "167"
      "yes":
      - "187"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.SecondFieldValue
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1670,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "176":
    id: "176"
    taskid: 1a0b999a-3d78-4469-8f65-dfaba9286f69
    type: regular
    task:
      id: 1a0b999a-3d78-4469-8f65-dfaba9286f69
      version: -1
      name: Set state and match
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "171"
    scriptarguments:
      key:
        simple: FirstStateMatch
      value:
        complex:
          root: ${State1}
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${Match1}
                iscontext: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1670,
          "y": -420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "177":
    id: "177"
    taskid: 8f7047aa-a162-432c-886b-deca7b49ff45
    type: regular
    task:
      id: 8f7047aa-a162-432c-886b-deca7b49ff45
      version: -1
      name: Set state
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "179"
    scriptarguments:
      key:
        simple: State1
      value:
        complex:
          root: inputs.FirstFieldState
          transformers:
          - operator: If-Then-Else
            args:
              condition: {}
              else:
                value:
                  simple: ' NOT '
              equals:
                value:
                  simple: include
              lhs: {}
              options: {}
              rhs: {}
              then:
                value:
                  simple: ' '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 800,
          "y": -795
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "178":
    id: "178"
    taskid: b6a62b11-4e02-434a-8fe3-d95ca131ad5a
    type: regular
    task:
      id: b6a62b11-4e02-434a-8fe3-d95ca131ad5a
      version: -1
      name: Set match
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "179"
    scriptarguments:
      key:
        simple: Match1
      value:
        simple: ' ILIKE '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1280,
          "y": -795
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "179":
    id: "179"
    taskid: 27b1f472-365d-462c-86a5-38955c5aa5cc
    type: regular
    task:
      id: 27b1f472-365d-462c-86a5-38955c5aa5cc
      version: -1
      name: Set state and match
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "182"
    scriptarguments:
      key:
        simple: FirstStateMatch
      value:
        complex:
          root: ${State1}
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${Match1}
                iscontext: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1020,
          "y": -420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "182":
    id: "182"
    taskid: 6a90173a-43ff-496b-8976-4973bf364dfe
    type: regular
    task:
      id: 6a90173a-43ff-496b-8976-4973bf364dfe
      version: -1
      name: Set partial values
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "184"
    scriptarguments:
      key:
        simple: FirstValues
      value:
        complex:
          root: inputs.FirstFieldValue
          transformers:
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
          - operator: concat
            args:
              prefix:
                value:
                  simple: '''%'
              suffix:
                value:
                  simple: '%'''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1020,
          "y": -265
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "183":
    id: "183"
    taskid: 57828335-ebf1-4ef9-8ad6-b0c297831908
    type: regular
    task:
      id: 57828335-ebf1-4ef9-8ad6-b0c297831908
      version: -1
      name: Set values
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "186"
    scriptarguments:
      key:
        simple: FirstInputQuery
      value:
        complex:
          root: UTF
          transformers:
          - operator: ProductJoin
            args:
              join:
                value:
                  simple: ${FirstStateMatch}
                iscontext: true
              list2:
                value:
                  simple: ${FirstValues}
                iscontext: true
          - operator: concat
            args:
              prefix:
                value:
                  simple: ' '
              suffix: {}
          - operator: join
            args:
              separator:
                value:
                  simple: ','
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ' OR '
              toReplace:
                value:
                  simple: ','
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1020,
          "y": 225
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "184":
    id: "184"
    taskid: 4f7a48de-b9c0-46e6-8c8a-4ae0fb250339
    type: regular
    task:
      id: 4f7a48de-b9c0-46e6-8c8a-4ae0fb250339
      version: -1
      name: Set UTF8(payload)
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "183"
    scriptarguments:
      key:
        simple: UTF
      value:
        simple: UTF8(payload)
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1020,
          "y": 80
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "185":
    id: "185"
    taskid: dbb808e8-3b06-49cd-81e5-8f13abbdd5fe
    type: playbook
    task:
      id: dbb808e8-3b06-49cd-81e5-8f13abbdd5fe
      version: -1
      name: QRadarFullSearch
      description: This playbook runs a QRadar query and return its results to the
        context.
      playbookName: QRadarFullSearch
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "164"
    scriptarguments:
      interval:
        simple: "1"
      query_expression:
        complex:
          root: ${FirstInputQuery}
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: ' from events where '
              suffix: {}
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ' '
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: inputs.TimeFrame
                iscontext: true
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.InvestigationUserFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ','
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.InvestigationIPFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.AdditionalSelectFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ','
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'DATEFORMAT(devicetime,''dd-MM-yyyy hh:mm''),LOGSOURCENAME(logsourceid),CATEGORYNAME(category),QIDNAME(qid) '
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'select '
              suffix:
                iscontext: true
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ',,'
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ' '
              toReplace:
                value:
                  simple: '  '
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ' ,'
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ', '
      timeout:
        simple: "600"
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 1020,
          "y": 575
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "186":
    id: "186"
    taskid: f3af727f-c9b2-4de4-8186-58c815e9563a
    type: condition
    task:
      id: f3af727f-c9b2-4de4-8186-58c815e9563a
      version: -1
      name: Are there second input values?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "185"
      "yes":
      - "187"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.SecondFieldValue
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1020,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "187":
    id: "187"
    taskid: a75ff0ac-bc19-4d4c-84d1-ddb03d2d9663
    type: title
    task:
      id: a75ff0ac-bc19-4d4c-84d1-ddb03d2d9663
      version: -1
      name: Second Input Search
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "188"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2090,
          "y": 575
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "188":
    id: "188"
    taskid: 0e5c8bd7-5d63-4614-810e-64bfd437ce3c
    type: condition
    task:
      id: 0e5c8bd7-5d63-4614-810e-64bfd437ce3c
      version: -1
      name: Were the second inputs provided properly?
      description: Is there an IP on which to search?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "234"
      "yes":
      - "189"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.SecondFieldValue
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              simple: inputs.SecondFieldState
            iscontext: true
          right:
            value:
              simple: include
        - operator: isEqualString
          left:
            value:
              simple: inputs.SecondFieldState
            iscontext: true
          right:
            value:
              simple: exclude
      - - operator: isEqualString
          left:
            value:
              simple: inputs.SecondFieldMatch
            iscontext: true
          right:
            value:
              simple: exact
        - operator: isEqualString
          left:
            value:
              simple: inputs.SecondFieldMatch
            iscontext: true
          right:
            value:
              simple: partial
    view: |-
      {
        "position": {
          "x": 2090,
          "y": 710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "189":
    id: "189"
    taskid: c4173c1b-f47e-45e5-824d-f68644bbc64a
    type: condition
    task:
      id: c4173c1b-f47e-45e5-824d-f68644bbc64a
      version: -1
      name: Are there fields for the second input?
      description: Is there a custom IP field?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "191"
      "yes":
      - "190"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: inputs.SecondFieldName
            iscontext: true
    view: |-
      {
        "position": {
          "x": 2090,
          "y": 1110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "190":
    id: "190"
    taskid: f2744719-d621-482e-85c1-fb32791a33c2
    type: title
    task:
      id: f2744719-d621-482e-85c1-fb32791a33c2
      version: -1
      name: QRadar query with custom fields
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "194"
      - "239"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2440,
          "y": 1360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "191":
    id: "191"
    taskid: b9486847-7769-48fe-893a-041420c70345
    type: title
    task:
      id: b9486847-7769-48fe-893a-041420c70345
      version: -1
      name: QRadar query without custom fields
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "202"
      - "201"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1740,
          "y": 1360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "192":
    id: "192"
    taskid: b90b840b-17d8-40ef-871e-e0acb20367bd
    type: playbook
    task:
      id: b90b840b-17d8-40ef-871e-e0acb20367bd
      version: -1
      name: QRadarFullSearch
      description: This playbook runs a QRadar query and return its results to the
        context.
      playbookName: QRadarFullSearch
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "164"
    scriptarguments:
      interval:
        simple: "1"
      query_expression:
        complex:
          root: ${SecondInputQuery}
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: ' from events where '
              suffix: {}
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ' '
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: inputs.TimeFrame
                iscontext: true
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ' '
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.InvestigationUserFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ','
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.InvestigationIPFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ','
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.AdditionalSelectFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ','
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'DATEFORMAT(devicetime,''dd-MM-yyyy hh:mm''),LOGSOURCENAME(logsourceid),CATEGORYNAME(category),QIDNAME(qid) '
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'select '
              suffix:
                iscontext: true
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ',,'
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ' '
              toReplace:
                value:
                  simple: '  '
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ' ,'
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ', '
      timeout:
        simple: "600"
    separatecontext: true
    loop:
      iscommand: false
      scriptArguments:
        headers: {}
        interval:
          simple: "1"
        query_expression:
          complex:
            root: ${FirstInputQuery}
            transformers:
            - operator: concat
              args:
                prefix:
                  value:
                    simple: ' from events where '
                suffix: {}
            - operator: concat
              args:
                prefix: {}
                suffix:
                  value:
                    simple: ' '
            - operator: concat
              args:
                prefix: {}
                suffix:
                  value:
                    simple: inputs.TimeFrame
                  iscontext: true
            - operator: concat
              args:
                prefix:
                  value:
                    simple: inputs.InvestigationUserFields
                  iscontext: true
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: ','
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: inputs.InvestigationIPFields
                  iscontext: true
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: ','
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: inputs.AdditionalSelectFields
                  iscontext: true
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: ','
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: 'DATEFORMAT(devicetime,''dd-MM-yyyy hh:mm''),LOGSOURCENAME(logsourceid),CATEGORYNAME(category),QIDNAME(qid) '
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: 'select '
                suffix:
                  iscontext: true
        range: {}
        timeout:
          simple: "600"
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2230,
          "y": 2920
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "194":
    id: "194"
    taskid: 4b53dee6-8009-417b-83e9-6d099f5b51af
    type: regular
    task:
      id: 4b53dee6-8009-417b-83e9-6d099f5b51af
      version: -1
      name: Set match
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "200"
    scriptarguments:
      key:
        simple: Match2
      value:
        complex:
          root: inputs.SecondFieldMatch
          transformers:
          - operator: If-Then-Else
            args:
              condition: {}
              else:
                value:
                  simple: ' ILIKE '
              equals:
                value:
                  simple: exact
              lhs: {}
              options: {}
              rhs: {}
              then:
                value:
                  simple: '= '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 3600,
          "y": 1505
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "195":
    id: "195"
    taskid: 58810417-9b8c-4e7b-84db-41a8f6fff62c
    type: regular
    task:
      id: 58810417-9b8c-4e7b-84db-41a8f6fff62c
      version: -1
      name: Set values
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "199"
    scriptarguments:
      key:
        simple: SecondInputQuery
      value:
        complex:
          root: inputs.SecondFieldName
          transformers:
          - operator: ProductJoin
            args:
              join:
                value:
                  simple: ${SecondStateMatch}
                iscontext: true
              list2:
                value:
                  simple: ${SecondValues}
                iscontext: true
          - operator: concat
            args:
              prefix:
                value:
                  simple: ' '
              suffix: {}
          - operator: join
            args:
              separator:
                value:
                  simple: ','
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ' OR '
              toReplace:
                value:
                  simple: ','
          - operator: concat
            args:
              prefix:
                value:
                  simple: ' AND '
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ${FirstInputQuery}
                iscontext: true
              suffix: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2230,
          "y": 2495
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "196":
    id: "196"
    taskid: cb5bfd15-a315-415f-885c-6d783468d6fb
    type: condition
    task:
      id: cb5bfd15-a315-415f-885c-6d783468d6fb
      version: -1
      name: First match exact or partial?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      exact:
      - "197"
      partial:
      - "198"
    separatecontext: false
    conditions:
    - label: exact
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.SecondFieldMatch
            iscontext: true
          right:
            value:
              simple: exact
    - label: partial
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.SecondFieldMatch
            iscontext: true
          right:
            value:
              simple: partial
    view: |-
      {
        "position": {
          "x": 2360,
          "y": 2040
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "197":
    id: "197"
    taskid: c35c9248-85c1-4c37-876b-bdb865b22edc
    type: regular
    task:
      id: c35c9248-85c1-4c37-876b-bdb865b22edc
      version: -1
      name: Set exact values
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "195"
    scriptarguments:
      key:
        simple: SecondValues
      value:
        complex:
          root: inputs.SecondFieldValue
          transformers:
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
          - operator: concat
            args:
              prefix:
                value:
                  simple: ''''
              suffix:
                value:
                  simple: ''''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2230,
          "y": 2280
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "198":
    id: "198"
    taskid: b3a13d04-79bc-4c97-893b-d53155797e9a
    type: regular
    task:
      id: b3a13d04-79bc-4c97-893b-d53155797e9a
      version: -1
      name: Set partial values
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "195"
    scriptarguments:
      key:
        simple: SecondValues
      value:
        complex:
          root: inputs.SecondFieldValue
          transformers:
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
          - operator: concat
            args:
              prefix:
                value:
                  simple: '''%'
              suffix:
                value:
                  simple: '%'''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2650,
          "y": 2280
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "199":
    id: "199"
    taskid: 697b3385-c6a0-43da-89fb-4a45342212a5
    type: condition
    task:
      id: 697b3385-c6a0-43da-89fb-4a45342212a5
      version: -1
      name: Are there third input values?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "192"
      "yes":
      - "209"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.ThirdFieldValue
            iscontext: true
    view: |-
      {
        "position": {
          "x": 2230,
          "y": 2700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "200":
    id: "200"
    taskid: 9ab80da6-1890-449e-8d14-971f2a5ac063
    type: regular
    task:
      id: 9ab80da6-1890-449e-8d14-971f2a5ac063
      version: -1
      name: Set state and match
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "196"
    scriptarguments:
      key:
        simple: SecondStateMatch
      value:
        complex:
          root: ${State2}
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${Match2}
                iscontext: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2360,
          "y": 1880
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "201":
    id: "201"
    taskid: f1a2391d-7cf9-4193-830a-e83c7dabd699
    type: regular
    task:
      id: f1a2391d-7cf9-4193-830a-e83c7dabd699
      version: -1
      name: Set state
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "203"
    scriptarguments:
      key:
        simple: State2
      value:
        complex:
          root: inputs.SecondFieldState
          transformers:
          - operator: If-Then-Else
            args:
              condition: {}
              else:
                value:
                  simple: ' NOT '
              equals:
                value:
                  simple: include
              lhs: {}
              options: {}
              rhs: {}
              then:
                value:
                  simple: ' '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1540,
          "y": 1505
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "202":
    id: "202"
    taskid: 946bc0b3-ab65-42d7-881b-fdf7a41e4a57
    type: regular
    task:
      id: 946bc0b3-ab65-42d7-881b-fdf7a41e4a57
      version: -1
      name: Set match
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "203"
    scriptarguments:
      key:
        simple: Match2
      value:
        simple: ' ILIKE '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1980,
          "y": 1505
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "203":
    id: "203"
    taskid: 683853aa-6b94-4be9-8468-33a47ed1a364
    type: regular
    task:
      id: 683853aa-6b94-4be9-8468-33a47ed1a364
      version: -1
      name: Set state and match
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "204"
    scriptarguments:
      key:
        simple: SecondStateMatch
      value:
        complex:
          root: ${State2}
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${Match2}
                iscontext: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1750,
          "y": 1880
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "204":
    id: "204"
    taskid: b84e1d5f-04df-467e-8db1-c66590b8c5a2
    type: regular
    task:
      id: b84e1d5f-04df-467e-8db1-c66590b8c5a2
      version: -1
      name: Set partial values
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "206"
    scriptarguments:
      key:
        simple: SecondValues
      value:
        complex:
          root: inputs.SecondFieldValue
          transformers:
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
          - operator: concat
            args:
              prefix:
                value:
                  simple: '''%'
              suffix:
                value:
                  simple: '%'''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1750,
          "y": 2040
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "205":
    id: "205"
    taskid: 8eb60387-0d9d-4377-8348-d70d84003084
    type: regular
    task:
      id: 8eb60387-0d9d-4377-8348-d70d84003084
      version: -1
      name: Set values
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "208"
    scriptarguments:
      key:
        simple: SecondInputQuery
      value:
        complex:
          root: UTF
          transformers:
          - operator: ProductJoin
            args:
              join:
                value:
                  simple: ${SecondStateMatch}
                iscontext: true
              list2:
                value:
                  simple: ${SecondValues}
                iscontext: true
          - operator: concat
            args:
              prefix:
                value:
                  simple: ' '
              suffix: {}
          - operator: join
            args:
              separator:
                value:
                  simple: ','
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ' OR '
              toReplace:
                value:
                  simple: ','
          - operator: concat
            args:
              prefix:
                value:
                  simple: ' AND '
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ${FirstInputQuery}
                iscontext: true
              suffix: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1750,
          "y": 2380
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "206":
    id: "206"
    taskid: daa96c8c-2a3c-4deb-85ba-531008f13192
    type: regular
    task:
      id: daa96c8c-2a3c-4deb-85ba-531008f13192
      version: -1
      name: Set UTF8(payload)
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "205"
    scriptarguments:
      key:
        simple: UTF
      value:
        simple: UTF8(payload)
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1750,
          "y": 2205
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "207":
    id: "207"
    taskid: 315e3159-e0fd-4cc8-8df3-6d8e31871864
    type: playbook
    task:
      id: 315e3159-e0fd-4cc8-8df3-6d8e31871864
      version: -1
      name: QRadarFullSearch
      description: This playbook runs a QRadar query and return its results to the
        context.
      playbookName: QRadarFullSearch
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "164"
    scriptarguments:
      interval:
        simple: "1"
      query_expression:
        complex:
          root: ${SecondInputQuery}
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: ' from events where '
              suffix: {}
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ' '
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: inputs.TimeFrame
                iscontext: true
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ' '
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.InvestigationUserFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ','
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.InvestigationIPFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ','
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.AdditionalSelectFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ','
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'DATEFORMAT(devicetime,''dd-MM-yyyy hh:mm''),LOGSOURCENAME(logsourceid),CATEGORYNAME(category),QIDNAME(qid) '
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'select '
              suffix:
                iscontext: true
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ',,'
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ' '
              toReplace:
                value:
                  simple: '  '
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ' ,'
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ', '
      timeout:
        simple: "600"
    separatecontext: true
    loop:
      iscommand: false
      scriptArguments:
        headers: {}
        interval:
          simple: "1"
        query_expression:
          complex:
            root: ${FirstInputQuery}
            transformers:
            - operator: concat
              args:
                prefix:
                  value:
                    simple: ' from events where '
                suffix: {}
            - operator: concat
              args:
                prefix: {}
                suffix:
                  value:
                    simple: ' '
            - operator: concat
              args:
                prefix: {}
                suffix:
                  value:
                    simple: inputs.TimeFrame
                  iscontext: true
            - operator: concat
              args:
                prefix:
                  value:
                    simple: inputs.InvestigationUserFields
                  iscontext: true
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: ','
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: inputs.InvestigationIPFields
                  iscontext: true
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: 'select '
                suffix:
                  iscontext: true
            - operator: concat
              args:
                prefix:
                  value:
                    simple: inputs.AdditionalSelectFields
                  iscontext: true
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: ','
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: 'DATEFORMAT(devicetime,''dd-MM-yyyy hh:mm''),LOGSOURCENAME(logsourceid),CATEGORYNAME(category),QIDNAME(qid) '
                suffix: {}
        range: {}
        timeout:
          simple: "600"
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1740,
          "y": 2920
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "208":
    id: "208"
    taskid: deffd27d-4b3b-441f-83ea-3687642141e2
    type: condition
    task:
      id: deffd27d-4b3b-441f-83ea-3687642141e2
      version: -1
      name: Are there third input values?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "207"
      "yes":
      - "209"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.ThirdFieldValue
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1750,
          "y": 2700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "209":
    id: "209"
    taskid: dda4cf61-d080-4a4b-8f26-b8f338151cbb
    type: title
    task:
      id: dda4cf61-d080-4a4b-8f26-b8f338151cbb
      version: -1
      name: Third Input Search
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "210"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2870,
          "y": 2870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "210":
    id: "210"
    taskid: 5edf7c48-9e46-4b20-82a0-870db66739fc
    type: condition
    task:
      id: 5edf7c48-9e46-4b20-82a0-870db66739fc
      version: -1
      name: Were the third inputs provided properly?
      description: Is there an IP on which to search?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "235"
      "yes":
      - "211"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.ThirdFieldValue
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              simple: inputs.ThirdFieldState
            iscontext: true
          right:
            value:
              simple: include
        - operator: isEqualString
          left:
            value:
              simple: inputs.ThirdFieldState
            iscontext: true
          right:
            value:
              simple: exclude
      - - operator: isEqualString
          left:
            value:
              simple: inputs.ThirdFieldMatch
            iscontext: true
          right:
            value:
              simple: exact
        - operator: isEqualString
          left:
            value:
              simple: inputs.ThirdFieldMatch
            iscontext: true
          right:
            value:
              simple: partial
    view: |-
      {
        "position": {
          "x": 2870,
          "y": 3015
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "211":
    id: "211"
    taskid: 03658eb8-d4f0-49dd-82e2-3998bbf5f58c
    type: condition
    task:
      id: 03658eb8-d4f0-49dd-82e2-3998bbf5f58c
      version: -1
      name: Are there fields for the third input?
      description: Is there a custom IP field?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "213"
      "yes":
      - "212"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: inputs.ThirdFieldName
            iscontext: true
    view: |-
      {
        "position": {
          "x": 2870,
          "y": 3360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "212":
    id: "212"
    taskid: fb100161-851b-4bb2-8b3a-0c5879cb499a
    type: title
    task:
      id: fb100161-851b-4bb2-8b3a-0c5879cb499a
      version: -1
      name: QRadar query with custom fields
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "216"
      - "243"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 3390,
          "y": 3570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "213":
    id: "213"
    taskid: 3b95e17d-577b-43f1-8597-979e5b384192
    type: title
    task:
      id: 3b95e17d-577b-43f1-8597-979e5b384192
      version: -1
      name: QRadar query without custom fields
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "224"
      - "223"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2640,
          "y": 3570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "214":
    id: "214"
    taskid: 9f726b26-d956-4e8e-8474-36dde2f373f6
    type: playbook
    task:
      id: 9f726b26-d956-4e8e-8474-36dde2f373f6
      version: -1
      name: QRadarFullSearch
      description: This playbook runs a QRadar query and return its results to the
        context.
      playbookName: QRadarFullSearch
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "164"
    scriptarguments:
      interval:
        simple: "1"
      query_expression:
        complex:
          root: ${ThirdInputQuery}
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: ' from events where '
              suffix: {}
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ' '
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: inputs.TimeFrame
                iscontext: true
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ' '
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.InvestigationUserFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ','
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.InvestigationIPFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ','
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.AdditionalSelectFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ','
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'DATEFORMAT(devicetime,''dd-MM-yyyy hh:mm''),LOGSOURCENAME(logsourceid),CATEGORYNAME(category),QIDNAME(qid) '
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'select '
              suffix:
                iscontext: true
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ',,'
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ' '
              toReplace:
                value:
                  simple: '  '
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ' ,'
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ', '
      timeout:
        simple: "600"
    separatecontext: true
    loop:
      iscommand: false
      scriptArguments:
        interval:
          simple: "1"
        query_expression:
          complex:
            root: ${SecondInputQuery}
            transformers:
            - operator: concat
              args:
                prefix:
                  value:
                    simple: ' from events where '
                suffix: {}
            - operator: concat
              args:
                prefix: {}
                suffix:
                  value:
                    simple: inputs.TimeFrame
                  iscontext: true
            - operator: concat
              args:
                prefix: {}
                suffix:
                  value:
                    simple: ' '
            - operator: concat
              args:
                prefix:
                  value:
                    simple: inputs.InvestigationUserFields
                  iscontext: true
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: ','
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: inputs.InvestigationIPFields
                  iscontext: true
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: ','
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: inputs.AdditionalSelectFields
                  iscontext: true
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: ','
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: 'DATEFORMAT(devicetime,''dd-MM-yyyy hh:mm''),LOGSOURCENAME(logsourceid),CATEGORYNAME(category),QIDNAME(qid) '
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: 'select '
                suffix:
                  iscontext: true
        timeout:
          simple: "600"
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 3410,
          "y": 4805
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "216":
    id: "216"
    taskid: 669b96fd-2843-4500-84d9-54f912baa30e
    type: regular
    task:
      id: 669b96fd-2843-4500-84d9-54f912baa30e
      version: -1
      name: Set match
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "222"
    scriptarguments:
      key:
        simple: Match3
      value:
        complex:
          root: inputs.ThirdFieldMatch
          transformers:
          - operator: If-Then-Else
            args:
              condition: {}
              else:
                value:
                  simple: ' ILIKE '
              equals:
                value:
                  simple: exact
              lhs: {}
              options: {}
              rhs: {}
              then:
                value:
                  simple: '= '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 4410,
          "y": 3740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "217":
    id: "217"
    taskid: e448c653-0988-4950-825d-f537b2a59fca
    type: regular
    task:
      id: e448c653-0988-4950-825d-f537b2a59fca
      version: -1
      name: Set values
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "214"
    scriptarguments:
      key:
        simple: ThirdInputQuery
      value:
        complex:
          root: inputs.ThirdFieldName
          transformers:
          - operator: ProductJoin
            args:
              join:
                value:
                  simple: ${ThirdStateMatch}
                iscontext: true
              list2:
                value:
                  simple: ${ThirdValues}
                iscontext: true
          - operator: concat
            args:
              prefix:
                value:
                  simple: ' '
              suffix: {}
          - operator: join
            args:
              separator:
                value:
                  simple: ','
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ' OR '
              toReplace:
                value:
                  simple: ','
          - operator: concat
            args:
              prefix:
                value:
                  simple: ' AND '
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ${SecondInputQuery}
                iscontext: true
              suffix: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 3410,
          "y": 4640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "218":
    id: "218"
    taskid: 73e8d5fe-31a0-4b9e-8f7d-ac841182d7f8
    type: condition
    task:
      id: 73e8d5fe-31a0-4b9e-8f7d-ac841182d7f8
      version: -1
      name: First match exact or partial?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      exact:
      - "219"
      partial:
      - "220"
    separatecontext: false
    conditions:
    - label: exact
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.ThirdFieldMatch
            iscontext: true
          right:
            value:
              simple: exact
    - label: partial
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.ThirdFieldMatch
            iscontext: true
          right:
            value:
              simple: partial
    view: |-
      {
        "position": {
          "x": 3410,
          "y": 4250
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "219":
    id: "219"
    taskid: 66bc2892-1c60-4ac3-8b73-2e62cdd5ff69
    type: regular
    task:
      id: 66bc2892-1c60-4ac3-8b73-2e62cdd5ff69
      version: -1
      name: Set exact values
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "217"
    scriptarguments:
      key:
        simple: ThirdValues
      value:
        complex:
          root: inputs.ThirdFieldValue
          transformers:
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
          - operator: concat
            args:
              prefix:
                value:
                  simple: ''''
              suffix:
                value:
                  simple: ''''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 3220,
          "y": 4470
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "220":
    id: "220"
    taskid: 5e14b8cd-6d0e-4ab9-8b98-8f94ba2d8b7a
    type: regular
    task:
      id: 5e14b8cd-6d0e-4ab9-8b98-8f94ba2d8b7a
      version: -1
      name: Set partial values
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "217"
    scriptarguments:
      key:
        simple: ThirdValues
      value:
        complex:
          root: inputs.ThirdFieldValue
          transformers:
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
          - operator: concat
            args:
              prefix:
                value:
                  simple: '''%'
              suffix:
                value:
                  simple: '%'''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 3630,
          "y": 4470
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "222":
    id: "222"
    taskid: 52f6246c-16d8-4321-8d63-89e923082cc5
    type: regular
    task:
      id: 52f6246c-16d8-4321-8d63-89e923082cc5
      version: -1
      name: Set state and match
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "218"
    scriptarguments:
      key:
        simple: ThirdStateMatch
      value:
        complex:
          root: ${State3}
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${Match3}
                iscontext: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 3410,
          "y": 4085
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "223":
    id: "223"
    taskid: 7381e031-03d4-4ac5-8acf-6c909a777280
    type: regular
    task:
      id: 7381e031-03d4-4ac5-8acf-6c909a777280
      version: -1
      name: Set state
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "225"
    scriptarguments:
      key:
        simple: State3
      value:
        complex:
          root: inputs.ThirdFieldState
          transformers:
          - operator: If-Then-Else
            args:
              condition: {}
              else:
                value:
                  simple: ' NOT '
              equals:
                value:
                  simple: include
              lhs: {}
              options: {}
              rhs: {}
              then:
                value:
                  simple: ' '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2420,
          "y": 3740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "224":
    id: "224"
    taskid: 87076354-e2c2-467c-8dd7-62d7409ae9e0
    type: regular
    task:
      id: 87076354-e2c2-467c-8dd7-62d7409ae9e0
      version: -1
      name: Set match
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "225"
    scriptarguments:
      key:
        simple: Match3
      value:
        simple: ' ILIKE '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2840,
          "y": 3740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "225":
    id: "225"
    taskid: c1672a40-ee90-44bd-8cf0-889266b61b75
    type: regular
    task:
      id: c1672a40-ee90-44bd-8cf0-889266b61b75
      version: -1
      name: Set state and match
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "226"
    scriptarguments:
      key:
        simple: ThirdStateMatch
      value:
        complex:
          root: ${State3}
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${Match3}
                iscontext: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2630,
          "y": 3960
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "226":
    id: "226"
    taskid: 8508e968-8a12-44b5-87c7-2ed0a592c367
    type: regular
    task:
      id: 8508e968-8a12-44b5-87c7-2ed0a592c367
      version: -1
      name: Set partial values
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "228"
    scriptarguments:
      key:
        simple: ThirdValues
      value:
        complex:
          root: inputs.ThirdFieldValue
          transformers:
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
          - operator: concat
            args:
              prefix:
                value:
                  simple: '''%'
              suffix:
                value:
                  simple: '%'''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2630,
          "y": 4190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "227":
    id: "227"
    taskid: 272bf371-5258-4456-80c4-a168fd99483b
    type: regular
    task:
      id: 272bf371-5258-4456-80c4-a168fd99483b
      version: -1
      name: Set values
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "229"
    scriptarguments:
      key:
        simple: ThirdInputQuery
      value:
        complex:
          root: UTF
          transformers:
          - operator: ProductJoin
            args:
              join:
                value:
                  simple: ${ThirdStateMatch}
                iscontext: true
              list2:
                value:
                  simple: ${ThirdValues}
                iscontext: true
          - operator: concat
            args:
              prefix:
                value:
                  simple: ' '
              suffix: {}
          - operator: join
            args:
              separator:
                value:
                  simple: ','
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ' OR '
              toReplace:
                value:
                  simple: ','
          - operator: concat
            args:
              prefix:
                value:
                  simple: ' AND '
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ${SecondInputQuery}
                iscontext: true
              suffix: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2630,
          "y": 4580
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "228":
    id: "228"
    taskid: 593fa40b-0ca1-4359-89b6-9907fbd5d082
    type: regular
    task:
      id: 593fa40b-0ca1-4359-89b6-9907fbd5d082
      version: -1
      name: Set UTF8(payload)
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "227"
    scriptarguments:
      key:
        simple: UTF
      value:
        simple: UTF8(payload)
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2630,
          "y": 4385
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "229":
    id: "229"
    taskid: 129f2f9c-efc6-44f2-8b08-f2cbc6b61d47
    type: playbook
    task:
      id: 129f2f9c-efc6-44f2-8b08-f2cbc6b61d47
      version: -1
      name: QRadarFullSearch
      description: This playbook runs a QRadar query and return its results to the
        context.
      playbookName: QRadarFullSearch
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "164"
    scriptarguments:
      interval:
        simple: "1"
      query_expression:
        complex:
          root: ${ThirdInputQuery}
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: ' from events where '
              suffix: {}
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ' '
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: inputs.TimeFrame
                iscontext: true
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ' '
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.InvestigationUserFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ','
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.InvestigationIPFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ','
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.AdditionalSelectFields
                iscontext: true
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: ','
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'DATEFORMAT(devicetime,''dd-MM-yyyy hh:mm''),LOGSOURCENAME(logsourceid),CATEGORYNAME(category),QIDNAME(qid) '
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'select '
              suffix:
                iscontext: true
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ',,'
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ' '
              toReplace:
                value:
                  simple: '  '
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ' ,'
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: ','
              toReplace:
                value:
                  simple: ', '
      timeout:
        simple: "600"
    separatecontext: true
    loop:
      iscommand: false
      scriptArguments:
        interval:
          simple: "1"
        query_expression:
          complex:
            root: ${SecondInputQuery}
            transformers:
            - operator: concat
              args:
                prefix:
                  value:
                    simple: ' from events where '
                suffix: {}
            - operator: concat
              args:
                prefix: {}
                suffix:
                  value:
                    simple: inputs.TimeFrame
                  iscontext: true
            - operator: concat
              args:
                prefix: {}
                suffix:
                  value:
                    simple: ' '
            - operator: concat
              args:
                prefix:
                  value:
                    simple: inputs.InvestigationUserFields
                  iscontext: true
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: ','
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: inputs.InvestigationIPFields
                  iscontext: true
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: ','
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: inputs.AdditionalSelectFields
                  iscontext: true
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: ','
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: 'DATEFORMAT(devicetime,''dd-MM-yyyy hh:mm''),LOGSOURCENAME(logsourceid),CATEGORYNAME(category),QIDNAME(qid) '
                suffix: {}
            - operator: concat
              args:
                prefix:
                  value:
                    simple: 'select '
                suffix:
                  iscontext: true
        timeout:
          simple: "600"
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2630,
          "y": 4805
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "231":
    id: "231"
    taskid: c1ef3023-cded-45f9-8982-b7e30b535dd0
    type: condition
    task:
      id: c1ef3023-cded-45f9-8982-b7e30b535dd0
      version: -1
      name: Was a first input provided?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "164"
      "yes":
      - "7"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.FirstFieldValue
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1070,
          "y": -1810
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "232":
    id: "232"
    taskid: 36474a6a-ba60-4f01-87c6-660d3a8bbaa9
    type: regular
    task:
      id: 36474a6a-ba60-4f01-87c6-660d3a8bbaa9
      version: -1
      name: Review and validate first inputs and rerun playbook
      type: regular
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "164"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 940,
          "y": -1340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "234":
    id: "234"
    taskid: 2df24ec3-e9f8-48e4-89b2-4fa546a78fa9
    type: regular
    task:
      id: 2df24ec3-e9f8-48e4-89b2-4fa546a78fa9
      version: -1
      name: Review and validate second inputs and rerun playbook
      type: regular
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "164"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1760,
          "y": 900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "235":
    id: "235"
    taskid: debaa17b-52e6-4d60-8861-c76e17731bff
    type: regular
    task:
      id: debaa17b-52e6-4d60-8861-c76e17731bff
      version: -1
      name: Review and validate third inputs and rerun playbook
      type: regular
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "164"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2580,
          "y": 3220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "236":
    id: "236"
    taskid: ffa6169d-53f4-4e06-8baf-84a06f64bdb7
    type: condition
    task:
      id: ffa6169d-53f4-4e06-8baf-84a06f64bdb7
      version: -1
      name: Check state and match
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      exclude exact:
      - "238"
      exclude partial:
      - "237"
      'include ':
      - "168"
    separatecontext: false
    conditions:
    - label: 'include '
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.FirstFieldState
            iscontext: true
          right:
            value:
              simple: include
    - label: exclude partial
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.FirstFieldState
            iscontext: true
          right:
            value:
              simple: exclude
      - - operator: isEqualString
          left:
            value:
              simple: inputs.FirstFieldMatch
            iscontext: true
          right:
            value:
              simple: partial
    - label: exclude exact
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.FirstFieldState
            iscontext: true
          right:
            value:
              simple: exclude
      - - operator: isEqualString
          left:
            value:
              simple: inputs.FirstFieldMatch
            iscontext: true
          right:
            value:
              simple: exact
    view: |-
      {
        "position": {
          "x": 1920,
          "y": -795
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "237":
    id: "237"
    taskid: 6cb12bcf-27af-49ff-886d-ef8c2731e398
    type: regular
    task:
      id: 6cb12bcf-27af-49ff-886d-ef8c2731e398
      version: -1
      name: Set state
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "176"
    scriptarguments:
      key:
        simple: State1
      value:
        simple: ' NOT '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2060,
          "y": -615
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "238":
    id: "238"
    taskid: 1c8d25ce-0812-4705-8493-9220533525fc
    type: regular
    task:
      id: 1c8d25ce-0812-4705-8493-9220533525fc
      version: -1
      name: Set state
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "176"
    scriptarguments:
      key:
        simple: State1
      value:
        simple: ' !'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2450,
          "y": -615
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "239":
    id: "239"
    taskid: cd0b24de-70ff-4266-83ec-5fd8aab942a0
    type: condition
    task:
      id: cd0b24de-70ff-4266-83ec-5fd8aab942a0
      version: -1
      name: Check state and match
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      exclude exact:
      - "242"
      exclude partial:
      - "241"
      'include ':
      - "240"
    separatecontext: false
    conditions:
    - label: 'include '
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.SecondFieldState
            iscontext: true
          right:
            value:
              simple: include
    - label: exclude partial
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.SecondFieldState
            iscontext: true
          right:
            value:
              simple: exclude
      - - operator: isEqualString
          left:
            value:
              simple: inputs.SecondFieldMatch
            iscontext: true
          right:
            value:
              simple: partial
    - label: exclude exact
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.SecondFieldState
            iscontext: true
          right:
            value:
              simple: exclude
      - - operator: isEqualString
          left:
            value:
              simple: inputs.SecondFieldMatch
            iscontext: true
          right:
            value:
              simple: exact
    view: |-
      {
        "position": {
          "x": 2660,
          "y": 1505
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "240":
    id: "240"
    taskid: 383f930e-f4d5-4397-8d40-b4a6caab116a
    type: regular
    task:
      id: 383f930e-f4d5-4397-8d40-b4a6caab116a
      version: -1
      name: Set state
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "200"
    scriptarguments:
      key:
        simple: State2
      value:
        simple: ' '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2360,
          "y": 1690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "241":
    id: "241"
    taskid: 2d381272-4a6c-4653-85f0-4cd26ce3770c
    type: regular
    task:
      id: 2d381272-4a6c-4653-85f0-4cd26ce3770c
      version: -1
      name: Set state
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "200"
    scriptarguments:
      key:
        simple: State2
      value:
        simple: ' NOT '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2780,
          "y": 1690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "242":
    id: "242"
    taskid: e3f75d87-9fc2-4307-816e-b5ec34b697a3
    type: regular
    task:
      id: e3f75d87-9fc2-4307-816e-b5ec34b697a3
      version: -1
      name: Set state
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "200"
    scriptarguments:
      key:
        simple: State2
      value:
        simple: ' !'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 3200,
          "y": 1690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "243":
    id: "243"
    taskid: de01eafb-d403-46b2-886d-064f336d622d
    type: condition
    task:
      id: de01eafb-d403-46b2-886d-064f336d622d
      version: -1
      name: Check state and match
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      exclude exact:
      - "246"
      exclude partial:
      - "245"
      'include ':
      - "244"
    separatecontext: false
    conditions:
    - label: 'include '
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.ThirdFieldState
            iscontext: true
          right:
            value:
              simple: include
    - label: exclude partial
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.ThirdFieldState
            iscontext: true
          right:
            value:
              simple: exclude
      - - operator: isEqualString
          left:
            value:
              simple: inputs.ThirdFieldMatch
            iscontext: true
          right:
            value:
              simple: partial
    - label: exclude exact
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.ThirdFieldState
            iscontext: true
          right:
            value:
              simple: exclude
      - - operator: isEqualString
          left:
            value:
              simple: inputs.ThirdFieldMatch
            iscontext: true
          right:
            value:
              simple: exact
    view: |-
      {
        "position": {
          "x": 3390,
          "y": 3740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "244":
    id: "244"
    taskid: 6406f1e0-87dd-4cdc-8ce1-f03e83ad9451
    type: regular
    task:
      id: 6406f1e0-87dd-4cdc-8ce1-f03e83ad9451
      version: -1
      name: Set state
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "222"
    scriptarguments:
      key:
        simple: State3
      value:
        simple: ' '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 3190,
          "y": 3910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "245":
    id: "245"
    taskid: c7aebfb2-03cf-47df-8842-652ccbbb050b
    type: regular
    task:
      id: c7aebfb2-03cf-47df-8842-652ccbbb050b
      version: -1
      name: Set state
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "222"
    scriptarguments:
      key:
        simple: State3
      value:
        simple: ' NOT '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 3590,
          "y": 3910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "246":
    id: "246"
    taskid: f1a403e5-8219-4d8f-89d8-50857d6ef961
    type: regular
    task:
      id: f1a403e5-8219-4d8f-89d8-50857d6ef961
      version: -1
      name: Set state
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "222"
    scriptarguments:
      key:
        simple: State3
      value:
        simple: ' !'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 3990,
          "y": 3910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 9385,
        "width": 4390,
        "x": 400,
        "y": -2260
      }
    }
  }
inputs:
- key: FirstFieldValue
  value: {}
  required: false
  description: The values of the first field to search. This can be a single value
    or a list of comma delimited values. For example admin1,admin2
  playbookInputQuery:
- key: FirstFieldName
  value: {}
  required: false
  description: The field names of the first field to search. This can be a single
    value or a list of comma delimited values. For example username,user
  playbookInputQuery:
- key: FirstFieldState
  value:
    simple: include
  required: false
  description: The state of the first field to search, meaning are the values in the
    field should be included or excluded. Valid options are include or exclude.
  playbookInputQuery:
- key: FirstFieldMatch
  value:
    simple: exact
  required: false
  description: Are the values of the first field suppose to be exact match or partial
    match. Valid options are exact or partial. When choosing exact the AQL query will
    use the = operator. When choosing partial the AQL query will ILIKE and add '%%'
    to the values.
  playbookInputQuery:
- key: SecondFieldValue
  value: {}
  required: false
  description: The values of the second field to search
  playbookInputQuery:
- key: SecondFieldName
  value: {}
  required: false
  description: The field names of the second field to search. This can be a single
    value or a list of comma delimited values. For example admin1,admin2
  playbookInputQuery:
- key: SecondFieldState
  value:
    simple: exclude
  required: false
  description: The state of the second field to search, meaning are the values in
    the field should be included or excluded. Valid options are include or exclude.
  playbookInputQuery:
- key: SecondFieldMatch
  value:
    simple: exact
  required: false
  description: 'Are the values of the second field suppose to be exact match or partial
    match. Valid options are exact or partial. '
  playbookInputQuery:
- key: ThirdFieldValue
  value: {}
  required: false
  description: The values of the third field to search. This can be a single value
    or a list of comma delimited values. For example admin1,admin2
  playbookInputQuery:
- key: ThirdFieldName
  value: {}
  required: false
  description: The field names of the third field to search. This can be a single
    value or a list of comma delimited values. For example username,user
  playbookInputQuery:
- key: ThirdFieldState
  value:
    simple: include
  required: false
  description: The state of the third field to search, meaning are the values in the
    field should be included or excluded. Valid options are include or exclude.
  playbookInputQuery:
- key: ThirdFieldMatch
  value:
    simple: exact
  required: false
  description: Are the values of the third field suppose to be exact match or partial
    match. Valid options are exact or partial. When choosing exact the AQL query will
    use the = operator. When choosing partial the AQL query will ILIKE and add '%%'
    to the values.
  playbookInputQuery:
- key: AdditionalSelectFields
  value: {}
  required: false
  description: |
    Add any additional fields you would like to be in the AQL select section.
  playbookInputQuery:
- key: TimeFrame
  value:
    simple: LAST 1 DAYS
  required: false
  description: |-
    Time frame as used in AQL
    Examples can be
    LAST 7 DAYS
    START '2019-09-25 15:51' STOP '2019-09-25 17:51'
    For more examples review IBM's AQL documentation.
  playbookInputQuery:
- key: InternalRange
  value: {}
  required: false
  description: 'A list of internal IP ranges to check IP addresses against. The list
    should be provided in CIDR notation, separated by commas. An example of a list
    of ranges would be: "172.16.0.0/12,10.0.0.0/8,192.168.0.0/16" (without quotes).
    If a list is not provided, will use default list provided in the IsIPInRanges
    script (the known IPv4 private address ranges).'
  playbookInputQuery:
- key: InvestigationIPFields
  value:
    simple: sourceip,destinationip
  required: true
  description: The values of these QRadar fields will be used for the playbook IP
    addresses outputs.
  playbookInputQuery:
- key: InvestigationUserFields
  value:
    simple: username
  required: true
  description: The values of these QRadar fields will be used for the playbook user
    name outputs.
  playbookInputQuery:
outputs:
- contextPath: QRadar.DetectedUsers
  description: Users detected based on the username field in your search.
  type: string
- contextPath: QRadar.DetectedInternalIPs
  description: Internal IP addresses detected based on fields and inputs in your search.
  type: string
- contextPath: QRadar.DetectedExternalIPs
  description: External IP addresses detected based on fields and inputs in your search.
  type: string
- contextPath: QRadar.DetectedInternalHosts
  description: Internal host names detected based on hosts in your assets table. Note
    that the data accuracy depends on how the Asset mapping is configured in QRadar.
  type: string
- contextPath: QRadar.DetectedExternalHosts
  description: External host names detected based on hosts in your assets table. Note
    that the data accuracy depends on how the Asset mapping is configured in QRadar.
  type: string
- contextPath: QRadar.Search.Result
  description: The full result of the search.
  type: string
tests:
- QRadar_v3-test
- QRadar Indicator Hunting Test
- test playbook - QRadarCorrelations For V2
- test playbook - QRadarCorrelations
- test_Qradar_v2
fromversion: 6.0.0
