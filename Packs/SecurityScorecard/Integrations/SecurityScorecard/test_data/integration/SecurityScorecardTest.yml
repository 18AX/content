name: SecurityScorecardTest
display: SecurityScorecardTest
category: Vulnerability Management
description: Test Integration for SecurityScorecard incident fetch. Fetches every minute.
isfetch: true
commonfields:
  id: SecurityScorecardTest
  version: -1
configuration:
# Connection Parameters
- name: apikey
  display: API Key
  additionalinfo: The API Key to use for connection
  required: true
  type: 4
  # TODO remove
  defaultvalue: dUAqyUVjOvfhgxlOtsqzAoM3pBtT
- name: username
  display: Username/Email
  additionalinfo: The username/email of your SecurityScorecard account. This account must exist in the SecurityScorecard system.
  # TODO remove
  defaultvalue: kgal@paloaltonetworks.com
  required: true
  type: 0
# Fetch Incident Parameters
- name: isFetch
  display: Fetch incidents
  required: true
  defaultvalue: true
  type: 8
- name: incidentFetchInterval
  display: Incidents Fetch Interval. SecurityScorecard is updated on a daily basis therefore there's no need to modify this value (24 h * 60 m/h = 1440m). This is hidden from the UI.
  defaultvalue: "1"
  required: false
  type: 19
  hidden: false
- name: maxIncidents
  display: Max incidents
  required: false
  defaultvalue: 100
  type: 0
- name: fetchDaysAgo
  display: Fetch days ago
  required: false
  defaultvalue: 7
  additionalinfo: How many days ago to fetch for when fetching for the first time
  type: 0
- name: incidentType
  display: Incident Type
  required: false
  defaultvalue: "SecurityScorecard Alert"
  type: 13
- name: insecure
  display: Trust any certificate (not secure)
  required: false
  type: 8
- name: proxy
  display: Use system proxy settings
  required: false
  type: 8
fromversion: 6.0.0
tests:
- No tests (auto formatted)
script:
  script: '-'
  type: python
  subtype: python3
  isFetchSamples: true
  isfetch: true
  dockerimage: demisto/python3:3.9.5.20070
  commands:
  - name: securityscorecard-portfolios-get
    description: Retrieve all portfolios
    outputs:
    - contextPath: SecurityScorecard.Portfolio.id
      description: Portfolio ID
      type: String
    - contextPath: SecurityScorecard.Portfolio.name
      description: Portfolio name
      type: String
    - contextPath: SecurityScorecard.Portfolio.description
      description: Portfolio description
      type: String
    - contextPath: SecurityScorecard.Portfolio.privacy
      description: Portfolio privacy. Can be either private, shared or team.
      type: String
    - contextPath: SecurityScorecard.Portfolio.read_only
      description: Whether the portfolio is read only.
      type: Boolean
  - name: securityscorecard-portfolio-get-companies
    description: Retrieve all companies in portfolio.
    arguments:
    - name: portfolio_id
      type: String
      description: Portfolio ID. A list of Portfolio IDs can be retrieved using the ``!securityscorecard-portfolios-get`` command.
      required: true
      default: false
    - name: grade
      type: String
      description: Grade filter. The acceptable values are capitalized letters between A-F, e.g. B.
      required: false
      default: false
      auto: PREDEFINED
      predefined:
      - "A"
      - "B"
      - "C"
      - "D"
      - "E"
      - "F"
    # TODO check what are all the options and add PREDEFINED
    - name: industry
      type: String
      description: Industry filter, e.g. information_services, technology.
      required: false
      default: false
    - name: vulnerability
      type: String
      description: Vulnerability filter. TODO NEED TO CHECK POSSIBLE VALUES.
      required: false
      default: false
    - name: issue_type
      type: String
      description: Issue type filter. TODO, need to list all possible values, can be found in active findings API.
      required: false
      default: false
    - name: had_breach_within_last_days
      type: Number
      description: Domains with breaches in the last X days. Possible values are numbers, e.g. 1000.
      required: false
      default: false
    outputs:
    - contextPath: SecurityScorecard.Company.domain
      description: Company domain.
      type: String
    - contextPath: SecurityScorecard.Company.name
      description: Company name.
      type: String
    - contextPath: SecurityScorecard.Company.score
      description: Company overall score in numeric form (55-100).
      type: Number
    - contextPath: SecurityScorecard.Company.grade
      description: Company overall score in letter grade.
      type: String
    - contextPath: SecurityScorecard.Company.grade_url
      description: Company overall score URL to SVG asset.
      type: String
    - contextPath: SecurityScorecard.Company.last30days_score_change
      description: Company overall score numeric change (±) in the last month.
      type: Number
    - contextPath: SecurityScorecard.Company.industry
      description: Industry category of the domain.
      type: String
    - contextPath: SecurityScorecard.Company.size
      description: Company size, e.g. 'size_more_than_10000'
      type: String
    - contextPath: SecurityScorecard.Company.is_custom_vendor
      description: Whether the company is a custom vendor.
      type: Boolean
    - contextPath: SecurityScorecard.Company.total
      description: Total number of companies in Portfolio.
      type: Number
  - name: securityscorecard-company-score-get
    description: Retrieve company overall score.
    arguments:
    - name: domain
      type: String
      description: Company domain, e.g. google.com
      required: true
      default: false
    outputs:
    - contextPath: SecurityScorecard.Company.Score.domain
      description: Company domain.
      type: String
    - contextPath: SecurityScorecard.Company.Score.name
      description: Company name.
      type: String
    - contextPath: SecurityScorecard.Company.Score.score
      description: Company overall score in numeric form (55-100).
      type: Number
    - contextPath: SecurityScorecard.Company.Score.grade
      description: Company overall score in letter grade form (A-F).
      type: String
    - contextPath: SecurityScorecard.Company.Score.last30days_score_change
      description: Company overall score numeric change (±) in the last month.
      type: Number
    - contextPath: SecurityScorecard.Company.Score.industry
      description: ndustry category of the domain.
      type: String
    - contextPath: SecurityScorecard.Company.Score.size
      description: Company size, e.g. 'size_more_than_10000'
      type: String 
  - name: securityscorecard-company-factor-score-get
    description: Retrieve company factor score.
    arguments:
    - name: domain
      type: String
      description: Company domain.
      required: true
      default: false
    - name: severity_in
      isArray: true
      description: Issue severity filter. Optional values can be positive, info, low, medium, high. Can be comma-separated list, e.g. 'medium,high,positive'
      required: false
    outputs:
    - contextPath: SecurityScorecard.Company.Factor.name
      description: Factor name.
      type: String
    - contextPath: SecurityScorecard.Company.Factor.score
      description: Factor score in numeric form (55-100)
      type: Number
    - contextPath: SecurityScorecard.Company.Factor.grade
      description: Factor score in letter grade form (A-F) 
      type: String
    - contextPath: SecurityScorecard.Company.Factor.Issue.type
      description: Type of issue found
      type: String
    - contextPath: SecurityScorecard.Company.Factor.Issue.count
      description: How many times the issue was found
      type: Number
    - contextPath: SecurityScorecard.Company.Factor.Issue.severity
      description: Severity of the issue
      type: String
    - contextPath: SecurityScorecard.Company.Factor.Issue.total_score_impact
      description: Contribution of issue on overall score
      type: Number
    - contextPath: SecurityScorecard.Company.Factor.Issue.detail_url
      description: URL to the details of the issue
      type: String
    - contextPath: SecurityScorecard.Company.Factor.total
      description: Number of factors returned
      type: Number
  - name: securityscorecard-company-history-score-get
    description: Retrieve company historical scores
    arguments:
    - name: domain
      type: String
      description: Company domain, e.g. `google.com`
      required: true
      default: false
    - name: from
      type: Date
      description: Initial date for historical data. Value should be in format `YYYY-MM-DD`
      required: false
      default: false
    - name: to
      type: Date
      description: Initial date for historical data. Value should be in format `YYYY-MM-DD`
      default: false
    - name: timing
      type: String
      description: Timing granularity. Acceptable values are `weekly` or `daily`
      required: false
      defaultvalue: daily
    outputs:
    - contextPath: SecurityScorecard.Company.History.domain
      description: Company domain.
      type: String
    - contextPath: SecurityScorecard.Company.History.date
      description: Score date.
      type: Date
    - contextPath: SecurityScorecard.Company.History.score
      description: Company historical security score in numeric form (55-100)
      type: Number
  - name: securityscorecard-company-history-factor-score-get
    description: Retrieve company historical factor scores
    arguments:
    - name: domain
      type: String
      description: Company domain, e.g. google.com
      required: true
      default: false
    - name: from
      type: Date
      description: Initial date for historical data. Value should be in format 'YYYY-MM-DD'
      required: false
      default: false
    - name: to
      type: Date
      description: Initial date for historical data. Value should be in format 'YYYY-MM-DD'
      default: false
    - name: timing
      type: String
      description: Timing granularity. Acceptable values are "daily" (default), "weekly" or "monthly"
      required: false
      defaultvalue: daily
    outputs:
    - contextPath: SecurityScorecard.Company.FactorHistory.domain
      description: Company domain.
      type: String
    - contextPath: SecurityScorecard.Company.FactorHistory.date
      description: Score date.
      type: Date
    - contextPath: SecurityScorecard.Company.FactorHistory.Factor.name
      description: Factor name.
      type: Number
    - contextPath: SecurityScorecard.Company.FactorHistory.score
      description: Company historical security score in numeric form (55-100)
      type: Number
  - name: securityscorecard-alert-grade-change-create
    description: Create alert based on grade
    arguments:
    - name: email
      type: String
      description: Email of alert recipient. The user must be registered in SecurityScorecard system.
      required: true
      default: false
    - name: change_direction
      type: String
      description: Direction of change. Possible values are 'rises' or 'drops'.
      required: true
    - name: score_types
      isArray: true
      description: Types of risk factors to monitor. Possible values are 'overall', 'any_factor_score', 'network_security', 'dns_health', 'patching_cadence', 'endpoint_security', 'ip_reputation', 'application_security', 'cubit_score', 'hacker_chatter', 'leaked_information', 'social_engineering'. For multiple factors, leaked_information,social_engineering .
      required: true
    - name: target
      isArray: true
      description: What do you want to monitor with this alert. It could be one of the following 'my_scorecard', 'any_followed_company' or comma-separated Portfolio IDs, e.g. 60c78cc2d63162001a68c2b8,60c8c5f9139e40001908c6a4 or 60c78cc2d63162001a68c2b8,my_scorecard
      required: true
    outputs:
    - contextPath: SecurityScorecard.Alert.id
      description: Alert ID
      type: String
  - name: securityscorecard-alert-score-threshold-create
    description: Create alert based threshold met
    arguments:
    - name: email
      type: String
      description: Email of alert recipient. The user must be registered in SecurityScorecard system.
      required: true
      default: false
    - name: change_direction
      type: String
      description: Direction of change. Possible values are 'rises_above' or 'drops_below'.
      required: true
    - name: threshold
      type: Number
      description: The numeric score used as the threshold to trigger the alert
      required: true
    - name: score_types
      isArray: true
      description: Types of risk factors to monitor. Possible values are 'overall', 'any_factor_score', 'network_security', 'dns_health', 'patching_cadence', 'endpoint_security', 'ip_reputation', 'application_security', 'cubit_score', 'hacker_chatter', 'leaked_information', 'social_engineering'. For multiple factors, leaked_information,social_engineering .
      required: true
    - name: target
      isArray: true
      description: What do you want to monitor with this alert. It could be one of the following 'my_scorecard', 'any_followed_company' or comma-separated Portfolio IDs, e.g. 60c78cc2d63162001a68c2b8,60c8c5f9139e40001908c6a4 or 60c78cc2d63162001a68c2b8,my_scorecard
      required: true
    outputs:
    - contextPath: SecurityScorecard.Alert.id
      description: Alert ID
      type: String
  - name: securityscorecard-alert-delete
    description: Delete an alert
    arguments:
    - name: email
      type: String
      description: Email of alert recipient.
      required: true
    - name: alert_id
      type: String
      description: Alert ID.  
      required: true
    - name: alert_type
      type: String
      description: Alert type. Can be either `score` or `grade`
      required: true
  - name: securityscorecard-alert-get-last-week
    description: Retrieve alerts triggered in the last week
    arguments:
    - name: email
      type: String
      description: Email of alert recipient.
      required: true
    - name: portfolio_id
      type: String
      description: Portfolio ID. Can be retrieved using ``!securityscorecard-portfolios-get```
      required: false
    outputs:
    - contextPath: SecurityScorecard.Alert.id
      description: Alert ID
      type: String
    - contextPath: SecurityScorecard.Alert.email
      description: Alert email recipient.
      type: String
    - contextPath: SecurityScorecard.Alert.change_type
      description: Alert change type configured (score or threshold)
      type: String
    - contextPath: SecurityScorecard.Alert.domain
      description: Alert domain
      type: String
    - contextPath: SecurityScorecard.Alert.company_name
      description: Alert company name
      type: String
    - contextPath: SecurityScorecard.Alert.Portfolio.id
      description: Alert Portfolio ID
      type: array
    - contextPath: SecurityScorecard.Alert.my_scorecard
      description: Whether the alert was triggered on private scorecard. This depends on whether 'my_scorecard' was added to the optional argument 'target' when creating alerts using the ``!securityscorecard-alert-score-threshold-create`` and ``!securityscorecard-alert-grade-change-create``` commands.
      type: Boolean
    - contextPath: SecurityScorecard.Alert.created_at
      description: Timestamp of when the alert was triggered
      type: Date
  - name: securityscorecard-company-services-get
    description: Retrieve the service providers of a domain
    arguments:
    - name: domain
      type: String
      description: Company domain
      required: true
    outputs:
    - contextPath: vendor_domain
      description: Vendor domain, e.g. Google, Amazon
      type: String
    - contextPath: client_domain
      description: Client domain. This value is identical to the input of the domain argument
      type: String
    - contextPath: categories
      description: Vendor service provider, e.g. mail_provider, nameserver_provider
      type: array